#!/bin/bash

# These columns are  recipe_name and long description
declare -x -r RECIPE_DESC=(
  "calculus               Calculus"
  "precalculus            Precalculus"
  "microbiology           Microbiology"
  "anatomy                Anatomy and Physiology"
  "history                U.S. History"
  "ap-history             AP U.S. History"
  "psychology             Psychology"
  "chemistry              Chemistry"
  "astronomy              Astronomy"
  "principles-management  Principles of Management"
  "entrepreneurship       Entrepreneurship"
  "accounting             Accounting"
  "business-ethics        Business Ethics"
  "intro-business         Intro to Business"
  "ap-biology             AP Biology"
  "ap-physics             AP Physics"
  "biology                Biology"
  "economics              Economics"
  "hs-physics             High School Physics"
  "physics                Physics"
  "statistics             Statistics"
  "TEAap-biology          AP-Biology (TEA version)"
  "TEAap-physics          AP-Physics (TEA version)"
  "TEAeconomics           Economics (TEA version)"
  "TEAhs-physics          High School Physics (TEA version)"
  "TEAstatistics          Statistics (TEA version)"
  "u-physics              University Physics"
  "sociology              Introduction to Sociology 2e"
  "dev-math               Developmental Math"
  "american-government    American Government"
)


# These columns are:
# - book_name
# - recipe_name
# - uuid : The uuid to use for ./script/fetch-book
# - host_name : The host_name to use when running ./script/fetch-book and ./script/bake-book-remote
# - additionalStyleguideDirs : These specify which additional directories should be included when building the styleguide
# - style_name : the name of the CSS styling to apply to the book

BOOK_CONFIGS=(
# "_example                   _example                           example-uuid                           col12345   tea.cnx.org         mixins/                   example"
  "calculus-vol1              calculus                           8b89d172-2927-466f-8661-01abc7ccdba4   col11964   katalyst01.cnx.org  mixins/"
  "calculus-vol2              calculus                           1d39a348-071f-4537-85b6-c98912458c3c   col11965   katalyst01.cnx.org  mixins/"
  "calculus-vol3              calculus                           a31cd793-2162-4e9e-acb5-6e6bbd76a5fa   col11966   katalyst01.cnx.org  mixins/"
  "precalculus                precalculus                        fd53eae1-fa23-47c7-bb1b-972349835c3c   col11667   easyvm5.cnx.org    mixins/"
  "college-algerbra           precalculus                        9b08c294-057f-4201-9f48-5d6ad992740d   col11759   easyvm5.cnx.org    mixins/"
  "algebra-trigonometry       precalculus                        13ac107a-f15f-49d2-97e8-60ab2e3b519c   col11758   easyvm5.cnx.org    mixins/"
  "microbiology               microbiology                       e42bd376-624b-4c0f-972f-e0c57998e765   col12087   easyvm5.cnx.org    mixins/"
  "anatomy                    anatomy                            14fb4ad7-39a1-4eee-ab6e-3ef2482e3e22   col11496   easyvm5.cnx.org    mixins/"
  "history                    history                            a7ba2fb8-8925-4987-b182-5f4429d48daa   col11740   easyvm5.cnx.org    mixins/"
  "aphistory                  ap-history                         0a621f27-abe1-4c17-8f1c-d80d07958977   col10034   content05.cnx.org  mixins/" 
  "psychology                 psychology                         4abf04bf-93a0-45c3-9cbc-2cefd46e68cc   col11629   easyvm5.cnx.org    mixins/"
  "chemistry                  chemistry                          85abf193-2bd2-4908-8563-90b8a7ac8df6   col11760   easyvm5.cnx.org    mixins/"
  "astronomy                  astronomy                          2e737be8-ea65-48c3-aa0a-9f35b4c6a966   col11992   easyvm5.cnx.org    mixins/"
  "principles-management      principles-management              62710222-02f1-4972-ab05-4060032e71f4                                 mixins/"
  "entrepreneurship           entrepreneurship                   ea5ef07f-f732-4a42-9351-4f0126dbe7a0                                 mixins/"
  "accounting                 accounting                         9ab4ba6d-1e48-486d-a2de-38ae1617ca84   col25448   easyvm5.cnx.org    mixins/"
  "business-ethics            business-ethics                    914ac66e-e1ec-486d-8a9c-97b0f7a99774   col25722   easyvm5.cnx.org    mixins/"
  "intro-business             intro-business                     4e09771f-a8aa-40ce-9063-aa58cc24e77f   col25734   easyvm5.cnx.org    mixins/                   intro-business"
  "statistics                 statistics                         30189442-6998-4686-ac05-ed152b91b9de   col11562   easyvm5.cnx.org    mixins/"
  "econ                       economics                          bc498e1f-efe9-43a0-8dea-d3569ad09a82   col12122   easyvm5.cnx.org    mixins/"
  "macroecon                  economics                          27f59064-990e-48f1-b604-5188b9086c29   col12190   easyvm5.cnx.org    mixins/"
  "macroeconap                economics                          9117cf8c-a8a3-4875-8361-9cb0f1fc9362   col23729   easyvm5.cnx.org    mixins/"
  "microecon                  economics                          5c09762c-b540-47d3-9541-dda1f44f16e5   col12170   easyvm5.cnx.org    mixins/"
  "microeconap                economics                          636cbfd9-4e37-4575-83ab-9dec9029ca4e   col23750   easyvm5.cnx.org    mixins/"
  "biology                    biology                            185cbf87-c72e-48f5-b51e-f14f21b5eabd   col11448   easyvm5.cnx.org    mixins/"
  "apbiology                  ap-biology                         6c322e32-9fb0-4c4d-a1d7-20c95c5c7af2   col12078   easyvm5.cnx.org    mixins/,books/biology"
  "physics                    physics                            031da8d3-b525-429c-80cf-6c8ed997733a   col11406   easyvm5.cnx.org    mixins/"
  "apphysics                  ap-physics                         8d04a686-d5e8-4798-a27d-c608e4d0e187   col11844   easyvm5.cnx.org    mixins/,books/physics/"
  "u-physics                  u-physics                          d50f6e32-0fda-46ef-a362-9bd36ca7c97d   col12031   easyvm5.cnx.org    mixins/,books/physics/"
  "katalyst-physics           u-physics                          4eaa8f03-88a8-485a-a777-dd3602f6c13e   col23946   easyvm5.cnx.org    mixins"
  "sociology                  sociology                          02040312-72c8-441e-a685-20e9333f3e1d   col11762   easyvm5.cnx.org    mixins/"
  "prealgebra                 dev-math                           caa57dab-41c7-455e-bd6f-f443cda5519c   col11756   easyvm5.cnx.org    mixins/"
  "elementary-algebra         dev-math                           0889907c-f0ef-496a-bcb8-2a5bb121717f   col12116   easyvm5.cnx.org    mixins/"
  "intermediate-algebra       dev-math                           02776133-d49d-49cb-bfaa-67c7f61b25a1   col12119   easyvm5.cnx.org    mixins/"
  "american-government        american-government                5bcc0e59-7345-421d-8507-a1e4608685e8   col11995   easyvm5.cnx.org    mixins/"
)

BOOK_NAMES=()
RECIPE_NAMES=()
STYLE_NAMES=()

export PLATFORMS=(pdf rex-web)

# From http://stackoverflow.com/a/8574392
containsElement () {
  local e
  for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
  return 1
}

# Use double-underscores so the name does not conflict with other scripts' local vars
# since this is loaded using 'source ./books.txt'
for __book_config in "${BOOK_CONFIGS[@]}"
do
  read -r __book_name __recipe_name _ _ _ _ __style_name <<< "${__book_config}"
  # Add to the list of BOOK_NAMES and RECIPE_NAMES
  containsElement "${__book_name}" "${BOOK_NAMES[@]}" || BOOK_NAMES+=("${__book_name}")
  containsElement "${__recipe_name}" "${RECIPE_NAMES[@]}" || RECIPE_NAMES+=("${__recipe_name}")

  if [[ ${__style_name} ]]; then
    containsElement "${__style_name} ${__book_name}" "${STYLE_NAMES[@]}" || STYLE_NAMES+=("${__style_name} ${__book_name}")
  fi
done
