// Books using those settings: Calculus Vol1, Vol2 and Vol3

$PagesWithBands: (
  (pageName: eoc, firstSelector: '.os-eoc.os-chapter-review-container', generalSelector: '.os-eoc'),
  (pageName: eob, firstSelector: '.os-eob[data-type="composite-chapter"]', generalSelector: '.os-eob'),
  (pageName: appendix, firstSelector: '.appendix', generalSelector: '.appendix'),
);

$bandColor: #093D4C;
$ChapterIntroType: fullWidth;

@import 'framework/framework';
@import '../../design-settings/corn/_design.scss';
@import '../../design-settings/corn/_settings.scss';
@import '../../designs/corn/pdf/folio_new';

//Settings

$noteTitlePadding: h-spacing(3);

@include add_settings((
  NoClassNote: (
    _selectors: ('[data-type="note"]:not([class])'),
    'Title:::background-color': (_ref: "colorMap:::boxedBackgroundColor"),
    'Title:::border-bottom-color': (_ref: "colorMap:::boxedBorderColor"),
    'Title:::color': (_ref: "colorMap:::boxedTitleColor"),
    'Title:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::boxedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::background-color': (_ref: "colorMap:::boxedBackgroundColor"),
  ),
  Try: (
    _selectors: ('[data-type="note"].try'),
    'Container:::display': table,
    'Title:::display': table-cell,
    'Title:::padding-right': $noteTitlePadding,
    'Title:::white-space': nowrap,
    'TitleLabel:::color': (_ref: "colorMap:::iconCondensedLabelColor"),
    'TitleLabel:::font-family': (_ref: "typography:::baseFont"),
    'TitleLabel:::margin-right': h-spacing(2),
    'TitleNumber:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'TitleNumber:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::display': table-cell,
    'TitleIcon:::background': url(toDataUri("svg+xml", "designs/corn/resources/corn-tryit.svg")) no-repeat top left,
    'TitleIcon:::flex-shrink': 0,
    'Subtitle:::color': (_ref: "colorMap:::iconBoxedTextColor"),
    'Subtitle:::font-family': (_ref: "typography:::titleFont"),
  ),
  GeneralStrategies: (
    _selectors: ('[data-type="note"].general-strategies'),
    'Container:::display': table,
    'Title:::display': table-cell,
    'Title:::padding-right': $noteTitlePadding,
    'Title:::white-space': nowrap,
    'TitleLabel:::color': (_ref: "colorMap:::iconCondensedLabelColor"),
    'TitleLabel:::font-family': (_ref: "typography:::baseFont"),
    'TitleLabel:::margin-right': h-spacing(2),
    'TitleNumber:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'TitleNumber:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::display': table-cell,
    'TitleIcon:::background': url(toDataUri("svg+xml", "designs/corn/resources/corn-manipmath.svg")) no-repeat top left,
    'TitleIcon:::flex-shrink': 0,
    'Subtitle:::color': (_ref: "colorMap:::iconBoxedTextColor"),
    'Subtitle:::font-family': (_ref: "typography:::titleFont"),
  ),
  MiniLessonQuestion: (
    _selectors: ('[data-type="note"].mini-lesson-question'),
    'Container:::display': table,
    'Title:::display': table-cell,
    'Title:::padding-right': $noteTitlePadding,
    'Title:::white-space': nowrap,
    'TitleLabel:::color': (_ref: "colorMap:::iconCondensedLabelColor"),
    'TitleLabel:::font-family': (_ref: "typography:::baseFont"),
    'TitleLabel:::margin-right': h-spacing(2),
    'TitleNumber:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'TitleNumber:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::display': table-cell,
    'TitleIcon:::background': url(toDataUri("svg+xml", "designs/corn/resources/corn-question.svg")) no-repeat top left,
    'TitleIcon:::flex-shrink': 0,
    'Subtitle:::color': (_ref: "colorMap:::iconBoxedTextColor"),
    'Subtitle:::font-family': (_ref: "typography:::titleFont"),
  ),
  LinkToLearning: (
    _selectors: ('[data-type="note"].link-to-learning'),
    'Container:::display': table,
    'Title:::display': table-cell,
    'Title:::padding-right': $noteTitlePadding,
    'Title:::white-space': nowrap,
    'TitleLabel:::color': (_ref: "colorMap:::iconCondensedLabelColor"),
    'TitleLabel:::font-family': (_ref: "typography:::baseFont"),
    'TitleLabel:::margin-right': h-spacing(2),
    'TitleNumber:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'TitleNumber:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::display': table-cell,
    'TitleIcon:::background': url(toDataUri("svg+xml", "designs/corn/resources/corn-link.svg")) no-repeat top left,
    'TitleIcon:::flex-shrink': 0,
    'Subtitle:::color': (_ref: "colorMap:::iconBoxedTextColor"),
    'Subtitle:::font-family': (_ref: "typography:::titleFont"),
  ),
  SelfCheck: (
    _selectors: ('[data-type="note"].self-check'),
    'Container:::display': table,
    'Title:::display': table-cell,
    'Title:::padding-right': $noteTitlePadding,
    'Title:::white-space': nowrap,
    'TitleLabel:::color': (_ref: "colorMap:::iconCondensedLabelColor"),
    'TitleLabel:::font-family': (_ref: "typography:::baseFont"),
    'TitleLabel:::margin-right': h-spacing(2),
    'TitleNumber:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'TitleNumber:::font-family': (_ref: "typography:::titleFont"),
    'Body:::color': (_ref: "colorMap:::iconCondensedTextColor"),
    'Body:::font-family': (_ref: "typography:::baseFont"),
    'Body:::display': table-cell,
    'TitleIcon:::background': url(toDataUri("svg+xml", "designs/corn/resources/corn-be-prepared.svg")) no-repeat top left,
    'TitleIcon:::flex-shrink': 0,
    'Subtitle:::color': (_ref: "colorMap:::iconBoxedTextColor"),
    'Subtitle:::font-family': (_ref: "typography:::titleFont"),
  ),
));

@include add_settings((
  EverydayExercises: (
    _selectors: ('section.numbered-exercises'),
    MultipartQuestionIdent: (
      margin-left: initial,
    ),
    // ExerciseImage: (
    //   max-width: calc(6in * 0.9 / 2),
    // ),
  ),
  // ReviewExercises: (
  //   _selectors: ('.os-eoc.os-review-exercises-container > section.review-exercises'),
  // ),
));


@include add_settings((
  PracticeExercises: ( // Two Column Exercise Module
    _selectors: ('section.practice'),
    MultipartQuestionIdent: (
      margin-left: initial,
    ),
    ExerciseContainer: (
      width: initial,
      display: initial,
    ),
    ProblemWrapper: (
      display: initial,
    ),
    // ExerciseImage: (
    //   max-width: calc(6in * 0.9 / 2),
    // ),
    ExercisesParagraphTitle: (
      font-family: (_ref: 'typography:::baseFont'),
      color: (_ref: 'colorMap:::moduleTitleColor'),
      margin-top: v-spacing(1),
      font-style: normal,
    ),
    ExercisesParagraphTitleItalic: (
      font-family: (_ref: 'typography:::baseFont'),
      color: (_ref: 'colorMap:::moduleTitleColor'),
      margin-top: v-spacing(1),
      font-style: italic,
    ),
    ProblemSolutionNumber: (
      color: (_ref: 'colorMap:::fontBodyColor'),
    ),
  ),
));



@mixin PracticeQuestionNumbers {
  section.practice [data-type=injected-exercise] {
    > [data-type=exercise-stimulus],
    > [data-type=exercise-question] [data-type=question-stem] {
      > ol:not([type=a]) > li::marker {
        @content;
      }
    }
  }
}

@include PracticeQuestionNumbers {
  font-weight: bold;
};

@include add_settings ((
  AnswerKeyExercisesSolutionLists: (
    _selectors: ('.os-eob.os-solutions-container [data-type="solution"]'),
  ),
  KeyEquations:(
      _selectors: (".os-key-equations-container"),
        'TableData:::font-family': (_ref: "typography:::baseFont"),
        'TableData:::padding-top': table-v-spacing(1),
        'TableData:::padding-bottom': table-v-spacing(1),
        'TableData:::padding-left': table-h-spacing(1),
        'TableData:::padding-right': table-h-spacing(1),
        'TableData:::border-bottom-width': 0.09rem,
        'TableData:::border-bottom-style': solid,
        'TableData:::border-bottom-color': (_ref: "colorMap:::keyEquationsBorderColor"),
        'TableData:::color': (_ref: "colorMap:::tableColor"),
  ),
));

@include add_settings((
  ModuleWithoutTitleLinks: (
    _selectors: ('.os-eos.os-section-exercises-container', '.os-eoc.os-review-exercises-container'),
  ),
));

@include add_settings((
  ModuleTitles: (
    _selectors: (
      settings('ModuleTitles:::_selectors'),
      '[data-type=unit] > [data-type=page]:not(.introduction)',
    )
  )
));

@mixin TableSettings {
  .os-table {

        // Prevent extremely wide images from overflowing the tables
    // Unfortunately, this seems like the best way to get prince to do that
    //
    // https://www.princexml.com/doc/styling/
    // When the fixed table layout algorithm is used [...] if the width
    // property has value auto (which is the default value), the table-layout
    // property will be ignored and automatic table layout will be used instead
    //
    // Other books use fixed colspec definitions to handle these problems
    // That would be possible here too, but that functionality would need to
    // be ported to `corn` and the content updated.
    //
    // Since only one table has this problem...
    // > table:has(figure img) {
    //   table-layout: fixed;
    //   max-width: half-fullBleedsSize(6.81, in);
    // }
    @each $cols in (2, 3, 4, 5, 6) {
      > table:has(tr > td:nth-of-type(#{$cols})):not(:has(tr > td:nth-of-type(#{$cols + 1}))) {
        img {
          max-width: calc(6in / $cols);
        }
      }
    }

    [data-type=injected-exercise]
    [data-type=exercise-question]
    .os-problem-container
    [data-type=answer-content] > & {
      display: initial;
      margin-left: initial;
      margin-right: initial;
    }
  }
}

@each $noteClass, $titleWidth in (
  ('try', 105px),
  ('self-check', 135px)
) {
  [data-type=note].#{$noteClass} {
    img {
      max-width: calc(6in - $titleWidth);
    }
  }
}

// 2.15.1 Analyzing Graphs that Represent Linear Equations and Inequalities ✅
// 3.1.4 Interpreting the Slope and Vertical Intercept of a Scatter Plot ✅
// Avoid breaks between `p` describing `media` and `media`
section.numbered-exercises, section.practice [data-type=problem] {
  > p:has(+ [data-type=media]) {
    break-after: avoid;
    break-inside: avoid-page;
  }
}

section.numbered-exercises [data-type=exercise]:has([data-type=problem] .os-problem-container [data-type=media]) {
  display: inline-block;
}

section.numbered-exercises [data-type=exercise] [data-type=problem]:has(.os-problem-container [data-type=media]) {
  display: flex;
  overflow-wrap: break-word;
}

section.numbered-exercises [data-type=exercise] [data-type=problem] .os-problem-container:has([data-type=media]) {
  display: flex;
  flex-wrap: wrap;
}

section.numbered-exercises [data-type=exercise] [data-type=problem] .os-problem-container [data-type=media] {
  width: 100%;
}

section.numbered-exercises [data-type=exercise] img,
section.numbered-exercises [data-type=injected-exercise] img {
  max-width: 100%;
}

// section.numbered-exercise [data-type=problem] > .os-problem-container:has([data-type=media]) {
//   overflow-wrap: anywhere;
// }

// 9.11.2 Does the Vertex Represent the Minimum or Maximum Value? Activity
// section {
//   margin-bottom: 1.7rem;
// }

@mixin HideSolutions {
  [data-type="solution"] {
    display: none;
  }
};

@mixin BorderlessTable {
  .os-table table.borderless {
    thead > tr > th,
    tbody > tr > td {
      border: none !important;
    }
  }
}

@mixin ImageBaseline {
  img {
    // 4.9.2 ✅
    height: auto;
    max-width: 100%;

    [data-type=media] > & {
      display: block;
      margin-bottom: #{v-spacing(2)};
    }
  }
}

@mixin TextOnlyChapterTitle(
  $mainFontColor,
  $mainFontFamily,
  $borderColor,
  $mainFontSize: font-scale(4)
) {
  [data-type=unit] > h1[data-type=document-title] {
    display: none;
  }

  [data-type=chapter] > h1[data-type=document-title] {
    display: flex;
    align-items: center;
    color: #{$mainFontColor};
    font-family: #{$mainFontFamily};
    font-size: #{$mainFontSize};
    line-height: #{$mainFontSize};
    height: font-scale(8);

    > .os-number {
      border-style: solid;
      border-width: 0.07rem;
      border-color: #{$borderColor};
      text-transform: uppercase;
      padding: 0.5rem;
      margin-right: 1rem;
    }

    > .os-part-text {
      display: none;
    }

    > .os-text {
      font-weight: bold;
      text-transform: uppercase;
      prince-filter-resolution: 300dpi;
      justify-content: center;
      align-items: center;
    }
  }
}

@mixin SplitMultipart {
  [data-type=exercise-stimulus] {
    > ol:not(.circled):not(.os-stepwise),
    > ul:not(.circled):not(.os-stepwise):not([data-labeled-item=true]) {
      // &:not(:nth-of-type(1)) {
        margin-left: #{h-spacing(3)};
      // }
    }
  }
}

@include HideSolutions();
@include BorderlessTable();
@include ImageBaseline();
@include TextOnlyChapterTitle(
  $mainFontColor: settings("colorMap:::boxedTitleColor"),
  $mainFontFamily: settings("typography:::titleFont"),
  $borderColor: settings("colorMap:::boxedTitleColor"),
);
@include TableSettings();
@include SplitMultipart();
@include use('BookRoot', "common:::BookRoot");
@include use('LearningObjectivesNumbered', 'corn:::LearningObjectivesNumberedShape');
@include use('TocUnit', 'corn:::UnitToc');
@include use('Example', 'corn:::ExampleShape');
@include use('ModuleWithoutTitleLinks','common:::ModuleWithoutTitleLinksShape'); // Used in eoc, eos exercises

// Chapter Intro
@include use('ChapterOutline', 'corn:::ChapterOutlineShape');

//Figures
@include use('Figure','corn:::FigureShape');
@include use('FigureSplash','corn:::FigureSplashShape');
@include use('FigureAfterSubtitle', 'corn:::FigureTopSpacingShape');
@include use('ImageAfterSolutionTitle', 'corn:::ImageTopSpacingShape');
@include use('FigureFromExercisesProblem','corn:::FigureFromExercisesShape');
@include use('FigureFromExercisesSolution','corn:::FigureFromExercisesShape');
@include use('FigureFromInjectedQuestion','corn:::FigureFromExercisesShape');
@include use('FigureFromInjectedSolution','corn:::FigureFromExercisesShape');
@include use('FigureAfterEocPara', 'corn:::FigureTopSpacingShape');
@include use('FigureAfterEobPara', 'corn:::FigureTopSpacingShape');
@include use('ImageAfterEocPara', 'corn:::ImageTopSpacingShape');
@include use('ImageAfterEobPara', 'corn:::ImageTopSpacingShape');
@include use('FigureAfterEosPara', 'corn:::FigureTopSpacingShape');
@include use('ImageAfterEosPara', 'corn:::ImageTopSpacingShape');

//Lists
@include use('PageLists', 'corn:::PageListsShape');
@include use('CompositePageLists', 'corn:::CompositePageListsShape');
@include use('StepwiseLists', 'corn:::StepwiseListsShape');
@include use('EosLists', 'corn:::EosListsShape');
@include use('NotesLists', 'corn:::NotesListsShape');
@include use('ListsFromExercises', 'corn:::ListsFromExercisesShape');

//Titles
// @include use('ChapterTitles', 'corn:::ChapterTitlesShape');
@include use('ChapterIntroTitles', 'corn:::ChapterIntroTitlesShape');
@include use('ModuleTitles', 'corn:::ModuleTitlesShape');
@include use('CompositeChapterTitles', 'corn:::CompositeChapterTitlesShape');
@include use('PageTitles', 'corn:::PageTitlesShape');
@include use('EobCompositePageTitles', 'corn:::CompositePageTitlesShape');

//Notes
@include use('NoClassNote', 'corn:::BoxedNoteShape');
@include use('Try', 'corn:::IconCondensedNoteWithSubtitleShape');
@include use('GeneralStrategies', 'corn:::IconCondensedNoteWithSubtitleShape');
@include use('MiniLessonQuestion', 'corn:::IconCondensedNoteWithSubtitleShape');
@include use('LinkToLearning', 'corn:::IconCondensedNoteWithSubtitleShape');
@include use('SelfCheck', 'corn:::IconCondensedNoteWithSubtitleShape');

//Equations
@include use('Equation', 'corn:::EquationShape');
@include use('NumberedEquation', 'corn:::NumberedEquationShape');

//Tables
@include use('BasicTable', 'corn:::BasicTableShape');
@include use('ColumnHeader', 'corn:::ColumnHeaderTableShape');
@include use('UnnumberedUnstyledTable', 'corn:::UnnumberedUnstyledTableShape');
@include use('DataTable', 'corn:::BasicTableShape');
@include use('TableFromMultiColumnExercises', 'corn:::TableFromExercisesShape');
@include use('TableFromExercisesLists', 'corn:::TableFromExercisesListsShape');
@include use('TableAfterExercisePara', 'corn:::TableTopSpacingShape');
@include use('TableFromAnswerKey', 'corn:::TableFromAnswerKeyShape');

//EoC
@include use('KeyTerms','corn:::KeyTermsShape');
@include use('ModuleWithMarginBottom','common:::ModuleWithMarginBottomShape');

// Exercises from Example
@include use('ExerciseFromExample', 'corn:::ExerciseFromExampleShape');

//Section Exercises
@include use('EverydayExercises', 'corn:::ExercisesModuleShape');
@include use('PracticeExercises', 'corn:::ExercisesModuleShape');

//Key Equations spacing
@include use('KeyEquations','corn:::ModuleWithUnstyledTableShape');

// EoC Exercises
// @include use('ReviewExercises', 'corn:::ExercisesModuleShape');

//EOB
@include use('AnswerKey', 'corn:::AnswerKeyShape');
@include use('AnswerKeyOneColumnEobSolution', 'corn:::AnswerKeySolutionShape');
@include use('Index', 'corn:::IndexShape');


// // Change the page number from 314 to 100π
// @page :nth(314):left         { @top-left-corner { content: "100π" "     "; } }
// @page :nth(314):right        { @top-right-corner { content: "     " "100π"; } }

// // Do the same for tau.
// // See https://www.scientificamerican.com/article/let-s-use-tau-it-s-easier-than-pi/
// @page :nth(628):left         { @top-left-corner { content: "100τ" "     "; } }
// @page :nth(628):right        { @top-right-corner { content: "     " "100τ"; } }

// @page :nth(2): left          { @top-left-corner { content: "TWO" "     "; } }
// @page :nth(2):right          { @top-right-corner { content: "     " "TWO"; } }
